<?php
/**
 *
 * @author Johan Steyn <jsteyn@quint.co.uk>
 * @link https://api.appcheck-ng.com/
 * @package    Inqbate\Appcheck
 * @copyright  2020 InQBate part of Quint Group
 * Date: 2020/03/05
 * Time: 10:00
 */

namespace Inqbate\Appcheck\Models;


use Inqbate\Appcheck\Client;
use Inqbate\Appcheck\Exceptions\ApiModelNotFoundException;

class Vulnerability extends ApiModel
{
    /**
     * @var string
     */
    private $scanId;
    /**
     * @var string
     */
    private $runId;

    /**
     * Scan constructor.
     * @param Client $client
     * @param string|null $scanId
     * @param string|null $runId
     * @param string $id
     */
    public function __construct(Client &$client, string $scanId = null, string $runId = null, string $id = null)
    {
        parent::__construct($client);
        if ($id != null) {
            return $this->find($id);
        }
        if ($scanId != null) {
            $this->setScanId($scanId);
        }
        if ($runId != null) {
            $this->setRunId($runId);
        }
    }

    /**
     * Get Scan ID
     * @return string|null
     */
    public function getScanId(): ?string
    {
        return $this->scanId;
    }

    /**
     * Set Scan Id
     * @param string $scanId
     */
    public function setScanId(string $scanId): void
    {
        $this->scanId = $scanId;
    }

    /**
     * get scan run id
     * @return string|null
     */
    public function getRunId(): ?string
    {
        return $this->runId;
    }

    /**
     * Set scan run id
     * @param string $runId
     */
    public function setRunId(string $runId): void
    {
        $this->runId = $runId;
    }

    /**
     * @inheritDoc
     */
    public function find(string $id)
    {
        $this->setId($id);
        return $this->setEndpoint('vulnerability/' . $id)->get();
    }

    /**
     * @inheritDoc
     */
    public function all(array $parameters = [])
    {
        $endpoint = '';

        if ($this->getScanId()) {
            $endpoint .= 'scan/' . $this->getScanId() . '/';
        }

        if ($this->getRunId()) {
            $endpoint .= 'run/' . $this->getRunId() . '/';
        }

        return $this->setEndpoint($endpoint . 'vulnerabilities')->get($parameters);
    }

    /**
     * @inheritDoc
     */
    public function create(array $data)
    {
        throw new ApiModelNotFoundException("Endpoint doesnt exist");
    }

    /**
     * @inheritDoc
     */
    public function update(array $data): bool
    {

        $data = $this->setEndpoint('vulnerability/' . $this->getId() . '/update')->post($data);
        return $data->success;
    }

    /**
     * @inheritDoc
     */
    public function delete(): bool
    {

        $data = $this->setEndpoint('vulnerability/' . $this->getId() . '/delete')->get();
        return $data->success;
    }
}
